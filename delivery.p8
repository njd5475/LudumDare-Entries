pico-8 cartridge // http://www.pico-8.com
version 41
__lua__

local objs,ctx={}, {score=0}

function _init()
 add(objs, sheepspwnr())
 add(objs, pillow(16, 16))
end

function _draw()
 cls(3)
 for y=1,128,16 do
 	line(0, y, 128, y, 11)
 end
 for o in all(objs) do
  if o.draw then
	 	o:draw()
 	end
 end
 print(ctx.score .. '000', 4, 4, 9)
end

function _update60()
	for o in all(objs) do
	 o:update(ctx)
	end
end

-->8
-- objects

function sheep(x,y)
 return {
  _type='sheep',
  reward=1,
  draw=function()
     spr(1, x, y)
  end,
  update=function(me, ctx)
    x-=1
    if x < -8 then
      ctx.score -= me.reward
      del(objs, me)
    end
  end,
  hit=function(me, ox, oy)
  	return col(x,y,ox,oy)
  end
 }
end

function sheepspwnr()
 local t=0
	return {
	 _type='spwnr',
		update=function()
			t+=1
			if t % 30 == 0 then
				add(objs, sheep(128, flr(rnd(5))*16))
			end
		end
	}
end

-- collision
function ins(x, y, bx, by, bw, bh)
	return x >= bx and
		x <= bx + bw and
		y >= by and
		y <= by + bh
end

function col(px, py, ox, oy)
		local pw, ph = 8, 8
		local ow, oh = 8, 8

		return ins(px, py, ox, oy, ow, oh) or
			ins(px+pw, py, ox, oy, ow, oh) or
			ins(px+pw, py+ph, ox, oy, ow, oh) or
			ins(px, py+ph, ox, oy, ow, oh) or
			ins(ox, oy, px, py, pw, ph) or
			ins(ox+ow, oy, px, py, pw, ph) or
			ins(ox, oy+oh, px, py, pw, ph) or
			ins(ox+ow, oy+oh, px, py, pw, ph)
			
end
-->8
-- pillow

function pillow(x,y)
	return {
	 _type='pillow',
		draw=function()
			spr(18, x,y)
		end,
		update=function(me, ctx)
			if btnp(2) then
				y -= 16
			end
			if btnp(3) then
				y += 16
			end
			for o in all(objs) do
				-- check collisions
				if o._type =='sheep' and o:hit(x,y) then
					del(objs, o)
					sfx(1)
					ctx.score += o.reward
				end
			end
		end
	}
end

__gfx__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000007770770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700777777770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000757777770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000777777770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700007777770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000007d77d70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000d00d00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000777000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000076007600777776600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000077777770077766600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000677777770077766000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000077777700077766000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000077007600777660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000777766000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000666000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
000100000c0500e050100501105000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0010000013050130501105010050100500e0501005011050110500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
